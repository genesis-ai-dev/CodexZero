{% macro translation_modals() %}
<!-- Translation Editor Modals -->

<!-- New Translation Modal -->
<div id="new-translation-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white border border-neutral-200 rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
        <h3 class="text-2xl font-bold text-neutral-900 mb-6 tracking-tight">Create New Translation</h3>
        <form id="new-translation-form" class="space-y-6">
            <div>
                <label for="translation-name" class="block text-sm font-medium text-neutral-700 mb-3">
                    Translation Name
                </label>
                <input 
                    type="text" 
                    id="translation-name" 
                    class="w-full p-4 border border-neutral-200 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 font-medium"
                    placeholder="e.g., Draft 1, Source ESV, Back Translation, etc."
                    required
                >
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" id="cancel-new-translation" class="px-6 py-3 border border-neutral-200 rounded-xl text-neutral-600 hover:text-neutral-900 hover:bg-neutral-50 transition-all duration-200 font-medium">
                    Cancel
                </button>
                <button type="submit" class="px-8 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                    Create
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Text Selection Modal -->
<div id="text-selection-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
    <div class="bg-white border border-neutral-200 rounded-2xl shadow-xl p-8 w-full max-w-md mx-4">
        <h3 class="text-2xl font-bold text-neutral-900 mb-6 tracking-tight">Load Text</h3>
        <div class="space-y-6">
            <div>
                <label for="text-select-button" class="block text-sm font-medium text-neutral-700 mb-3">
                    Select Text to Load
                </label>
                <!-- Custom Text Dropdown -->
                <div class="relative">
                    <button id="text-select-button" class="w-full p-4 bg-white border border-neutral-200 rounded-xl text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                        <span id="text-select-text" class="flex-1 truncate">Choose a text...</span>
                        <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="text-select-chevron"></i>
                    </button>
                    <div id="text-select-dropdown" class="absolute z-50 w-full mt-1 bg-white border border-neutral-200 rounded-xl shadow-lg hidden max-h-60 overflow-y-auto">
                        <div class="p-4 text-sm text-neutral-500 text-center">Loading texts...</div>
                    </div>
                </div>
            </div>
            
            <div id="text-info" class="hidden p-4 bg-blue-50 border border-blue-200 rounded-xl">
                <div id="text-details" class="text-sm text-blue-900 font-medium">Loading...</div>
            </div>
            
            <div class="flex justify-end space-x-3 pt-4">
                <button type="button" id="cancel-text-selection" class="px-6 py-3 border border-neutral-200 rounded-xl text-neutral-600 hover:text-neutral-900 hover:bg-neutral-50 transition-all duration-200 font-medium">
                    Cancel
                </button>
                <button type="button" id="add-text-btn" class="hidden px-8 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                    Load Text
                </button>
                <button type="button" id="new-translation-btn" class="px-8 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-xl hover:from-green-700 hover:to-green-800 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                    + New Translation
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Custom dropdown functionality for text selection modal
function initializeTextSelectionDropdown() {
    const button = document.getElementById('text-select-button');
    const dropdown = document.getElementById('text-select-dropdown');
    const chevron = document.getElementById('text-select-chevron');
    
    if (!button || !dropdown || !chevron) return;
    
    // Toggle dropdown
    button.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = !dropdown.classList.contains('hidden');
        
        if (isOpen) {
            dropdown.classList.add('hidden');
            chevron.style.transform = 'rotate(0deg)';
        } else {
            dropdown.classList.remove('hidden');
            chevron.style.transform = 'rotate(180deg)';
        }
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!button.contains(e.target) && !dropdown.contains(e.target)) {
            dropdown.classList.add('hidden');
            chevron.style.transform = 'rotate(0deg)';
        }
    });
}

// Helper functions for text selection dropdown
window.setTextDropdownOption = function(value, text, metadata = {}) {
    const button = document.getElementById('text-select-button');
    const textElement = document.getElementById('text-select-text');
    const dropdown = document.getElementById('text-select-dropdown');
    const chevron = document.getElementById('text-select-chevron');
    const addBtn = document.getElementById('add-text-btn');
    const textInfo = document.getElementById('text-info');
    const textDetails = document.getElementById('text-details');
    
    if (textElement) {
        textElement.textContent = text;
    }
    
    // Store the value and metadata on the button for retrieval
    button.dataset.value = value;
    button.dataset.metadata = JSON.stringify(metadata);
    
    // Show text info and add button if a text is selected
    if (value && addBtn) {
        addBtn.classList.remove('hidden');
        
        if (textInfo && textDetails && metadata) {
            textDetails.textContent = `${metadata.name || text}${metadata.progress !== undefined ? ` (${metadata.progress}% complete)` : ''}`;
            textInfo.classList.remove('hidden');
        }
    }
    
    // Close dropdown
    dropdown.classList.add('hidden');
    chevron.style.transform = 'rotate(0deg)';
    
    // Trigger change event for compatibility
    const event = new CustomEvent('change', { detail: { value: value, metadata: metadata } });
    button.dispatchEvent(event);
};

window.populateTextDropdown = function(texts) {
    const dropdown = document.getElementById('text-select-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    if (!texts || texts.length === 0) {
        dropdown.innerHTML = '<div class="p-4 text-sm text-neutral-500 text-center italic">No texts available</div>';
        return;
    }
    
    texts.forEach(text => {
        const option = document.createElement('div');
        option.className = 'dropdown-option px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-900 cursor-pointer border-b border-neutral-100 last:border-b-0 transition-all duration-200 flex items-center justify-between group';
        option.innerHTML = `
            <div class="flex-1">
                <div class="font-medium text-neutral-900">${text.name}</div>
                ${text.progress !== undefined ? `<div class="text-xs text-neutral-500 mt-1">${text.progress}% complete</div>` : ''}
            </div>
            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <i class="fas fa-check text-neutral-400 text-xs"></i>
            </div>
        `;
        option.addEventListener('click', () => {
            setTextDropdownOption(text.value, text.name, text);
        });
        dropdown.appendChild(option);
    });
};

// Initialize when modal is shown
document.addEventListener('DOMContentLoaded', () => {
    initializeTextSelectionDropdown();
});
</script>
{% endmacro %} 