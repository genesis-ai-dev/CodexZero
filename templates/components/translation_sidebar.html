{% macro translation_sidebar(project) %}
<!-- Translation Sidebar -->
<div class="h-full flex flex-col bg-white/95 backdrop-blur-sm border-r border-neutral-200 shadow-lg">
    
    <!-- Desktop Collapse Button -->
    <div class="hidden md:flex justify-end p-2 border-b border-neutral-200/50">
        <button id="desktop-sidebar-toggle" class="p-2 text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-all duration-200" title="Collapse sidebar">
            <i id="desktop-sidebar-icon" class="fas fa-chevron-left text-sm"></i>
        </button>
    </div>
    
    <!-- Sidebar Content -->
    <div id="sidebar-content" class="sidebar-collapsible-content">
        <!-- Model Selection -->
        <div class="border-b border-neutral-200 p-6 flex-shrink-0">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-neutral-900 tracking-tight">Translation Model</h3>
                <button id="refresh-models-btn" class="p-2 text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-all duration-200" title="Refresh models">
                    <i class="fas fa-sync-alt text-sm"></i>
                </button>
            </div>
            
            <!-- Custom Model Dropdown -->
            <div class="relative mb-3">
                <button id="translation-model-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                    <span id="translation-model-text" class="flex-1 truncate">Loading models...</span>
                    <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="translation-model-chevron"></i>
                </button>
                <div id="translation-model-dropdown" class="absolute z-[9999] bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto w-full top-full mt-1"></div>
            </div>
      
        </div>
        
        <!-- Navigation Section -->
        <div class="p-6 flex-1">
            <!-- Navigation Sync Indicator -->
            <div id="nav-sync-indicator" class="hidden mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-center text-sm text-blue-700">
                    <i class="fas fa-sync-alt fa-spin mr-2"></i>
                    <span>Syncing with scroll position...</span>
                </div>
            </div>
            
            <!-- Book Selection -->
            <div class="relative mb-4">
                <button id="goto-book-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                    <span id="goto-book-text" class="flex-1 truncate">Select Book...</span>
                    <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="goto-book-chevron"></i>
                </button>
                <div id="goto-book-dropdown" class="absolute z-[9999] bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto w-full top-full mt-1"></div>
            </div>
            
            <!-- Chapter Selection -->
            <div class="relative mb-6">
                <button id="goto-chapter-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                    <span id="goto-chapter-text" class="flex-1 truncate">Select Chapter...</span>
                    <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="goto-chapter-chevron"></i>
                </button>
                <div id="goto-chapter-dropdown" class="absolute z-[9999] bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto w-full top-full mt-1"></div>
            </div>
            
        </div>
    </div>
</div>

<style>
/* Hide sidebar content when collapsed */
.sidebar-collapsed .sidebar-collapsible-content {
    display: none;
}
</style>

<script>
// Simple dropdown system
function initDropdowns() {
    const dropdowns = [
        { button: 'translation-model-button', dropdown: 'translation-model-dropdown', chevron: 'translation-model-chevron' },
        { button: 'goto-book-button', dropdown: 'goto-book-dropdown', chevron: 'goto-book-chevron' },
        { button: 'goto-chapter-button', dropdown: 'goto-chapter-dropdown', chevron: 'goto-chapter-chevron' }
    ];

    dropdowns.forEach(({ button, dropdown, chevron }) => {
        const btn = document.getElementById(button);
        const dd = document.getElementById(dropdown);
        const chev = document.getElementById(chevron);

        if (!btn || !dd || !chev) return;

        btn.addEventListener('click', () => {
            // Close all dropdowns first
            dropdowns.forEach(({ dropdown: otherDd, chevron: otherChev }) => {
                const otherDropdown = document.getElementById(otherDd);
                const otherChevron = document.getElementById(otherChev);
                if (otherDropdown && otherChevron) {
                    otherDropdown.classList.add('hidden');
                    otherChevron.style.transform = 'rotate(0deg)';
                }
            });

            // Toggle this dropdown
            const isHidden = dd.classList.contains('hidden');
            if (isHidden) {
                dd.classList.remove('hidden');
                chev.style.transform = 'rotate(180deg)';
            }
        });
    });

    // Close on outside click
    document.addEventListener('click', (e) => {
        if (!e.target.closest('[id$="-button"]') && !e.target.closest('[id$="-dropdown"]')) {
            dropdowns.forEach(({ dropdown, chevron }) => {
                const dd = document.getElementById(dropdown);
                const chev = document.getElementById(chevron);
                if (dd && chev) {
                    dd.classList.add('hidden');
                    chev.style.transform = 'rotate(0deg)';
                }
            });
        }
    });
}

document.addEventListener('DOMContentLoaded', initDropdowns);

// Navigation sync feedback
document.addEventListener('navigationUpdated', (event) => {
    const indicator = document.getElementById('nav-sync-indicator');
    if (indicator) {
        indicator.classList.remove('hidden');
        setTimeout(() => indicator.classList.add('hidden'), 1500);
    }
});

// API functions
window.populateModelDropdown = function(models) {
    const dropdown = document.getElementById('translation-model-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    models.forEach(model => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 cursor-pointer border-b border-neutral-100 last:border-b-0';
        option.textContent = model.name;
        option.dataset.value = model.value;
        option.addEventListener('click', () => {
            // Update display
            document.getElementById('translation-model-text').textContent = model.name;
            dropdown.classList.add('hidden');
            document.getElementById('translation-model-chevron').style.transform = 'rotate(0deg)';
            
            // Store the model value and trigger the change
            const button = document.getElementById('translation-model-button');
            button.dataset.value = model.value;
            
            // Trigger model change via translation UI
            if (window.translationEditor && window.translationEditor.ui) {
                window.translationEditor.ui.setTranslationModel(model.value);
            }
        });
        dropdown.appendChild(option);
    });
};

window.populateBookDropdown = function(books) {
    const dropdown = document.getElementById('goto-book-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    books.forEach(book => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 cursor-pointer border-b border-neutral-100 last:border-b-0';
        option.textContent = book.name;
        option.addEventListener('click', () => {
            document.getElementById('goto-book-text').textContent = book.name;
            dropdown.classList.add('hidden');
            document.getElementById('goto-book-chevron').style.transform = 'rotate(0deg)';
        });
        dropdown.appendChild(option);
    });
};

window.populateChapterDropdown = function(chapters) {
    const dropdown = document.getElementById('goto-chapter-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    chapters.forEach(chapter => {
        const option = document.createElement('div');
        option.className = 'px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 cursor-pointer border-b border-neutral-100 last:border-b-0';
        option.textContent = chapter.name;
        option.addEventListener('click', () => {
            document.getElementById('goto-chapter-text').textContent = chapter.name;
            dropdown.classList.add('hidden');
            document.getElementById('goto-chapter-chevron').style.transform = 'rotate(0deg)';
        });
        dropdown.appendChild(option);
    });
};

window.setBookDropdownOption = function(value, text) {
    document.getElementById('goto-book-text').textContent = text;
};

window.setChapterDropdownOption = function(value, text) {
    document.getElementById('goto-chapter-text').textContent = text;
};

window.setModelDropdownOption = function(value, text) {
    const button = document.getElementById('translation-model-button');
    const textElement = document.getElementById('translation-model-text');
    if (button && textElement) {
        button.dataset.value = value;
        textElement.textContent = text;
    }
};
</script>
{% endmacro %} 