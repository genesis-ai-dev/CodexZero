{% macro translation_sidebar(project) %}
<!-- Translation Sidebar -->
<div class="h-full flex flex-col bg-white/95 backdrop-blur-sm border-r border-neutral-200 shadow-lg">
    
    <!-- Save Button -->
    <div class="border-b border-neutral-200 p-6 flex-shrink-0">
        <button id="save-changes-btn" class="w-full py-3 px-4 text-sm font-semibold bg-neutral-100 hover:bg-neutral-200 text-neutral-700 hover:text-neutral-900 rounded-lg transition-all duration-200 border border-neutral-200 hover:border-neutral-300 shadow-sm">
            NO CHANGES TO SAVE
        </button>
    </div>
    
    <!-- Model Selection -->
    <div class="border-b border-neutral-200 p-6 flex-shrink-0">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-neutral-900 tracking-tight">Translation Model</h3>
            <button id="refresh-models-btn" class="p-2 text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-all duration-200" title="Refresh models">
                <i class="fas fa-sync-alt text-sm"></i>
            </button>
        </div>
        <p class="text-sm text-neutral-600 mb-4 leading-relaxed">Choose base models or your custom fine-tuned models</p>
        
        <!-- Custom Model Dropdown -->
        <div class="relative mb-3">
            <button id="translation-model-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                <span id="translation-model-text" class="flex-1 truncate">Loading models...</span>
                <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="translation-model-chevron"></i>
            </button>
            <div id="translation-model-dropdown" class="absolute z-50 w-full mt-1 bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto">
                <div class="p-2 text-sm text-neutral-500 text-center">Loading models...</div>
            </div>
        </div>
        
        <!-- Model Info -->
        <div id="model-info" class="hidden mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <div id="model-description" class="text-sm text-blue-900 mb-1"></div>
            <div id="model-type" class="text-xs text-blue-700 font-medium"></div>
        </div>
        
    </div>
    
    <!-- Navigation Section -->
    <div class="p-6 flex-1 overflow-y-auto">
        <h3 class="text-lg font-bold text-neutral-900 tracking-tight mb-4">Navigation</h3>
        
        <!-- Book Selection -->
        <div class="mb-4">
            <label class="block text-sm font-medium text-neutral-600 mb-2">Book</label>
            <div class="relative">
                <button id="goto-book-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                    <span id="goto-book-text" class="flex-1 truncate">Select Book...</span>
                    <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="goto-book-chevron"></i>
                </button>
                <div id="goto-book-dropdown" class="absolute z-50 w-full mt-1 bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto">
                    <div class="p-2 text-sm text-neutral-500 text-center">Select a book...</div>
                </div>
            </div>
        </div>
        
        <!-- Chapter Selection -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-neutral-600 mb-2">Chapter</label>
            <div class="relative">
                <button id="goto-chapter-button" class="w-full p-3 bg-white border border-neutral-200 rounded-lg text-left text-neutral-900 font-medium focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 flex items-center justify-between hover:bg-neutral-50 hover:border-neutral-300 shadow-sm" type="button">
                    <span id="goto-chapter-text" class="flex-1 truncate">Select Chapter...</span>
                    <i class="fas fa-chevron-down text-neutral-400 transition-transform duration-200 ml-2" id="goto-chapter-chevron"></i>
                </button>
                <div id="goto-chapter-dropdown" class="absolute z-50 w-full mt-1 bg-white border border-neutral-200 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto">
                    <div class="p-2 text-sm text-neutral-500 text-center">Select a chapter...</div>
                </div>
            </div>
        </div>
        

    </div>
</div>

<script>
// Custom dropdown functionality
function initializeCustomDropdowns() {
    // Model dropdown
    const modelButton = document.getElementById('translation-model-button');
    const modelDropdown = document.getElementById('translation-model-dropdown');
    const modelChevron = document.getElementById('translation-model-chevron');
    
    // Book dropdown
    const bookButton = document.getElementById('goto-book-button');
    const bookDropdown = document.getElementById('goto-book-dropdown');
    const bookChevron = document.getElementById('goto-book-chevron');
    
    // Chapter dropdown
    const chapterButton = document.getElementById('goto-chapter-button');
    const chapterDropdown = document.getElementById('goto-chapter-dropdown');
    const chapterChevron = document.getElementById('goto-chapter-chevron');
    
    // Generic dropdown toggle function
    function toggleDropdown(button, dropdown, chevron) {
        const isOpen = !dropdown.classList.contains('hidden');
        
        // Close all dropdowns first
        document.querySelectorAll('[id$="-dropdown"]').forEach(dd => {
            dd.classList.add('hidden');
        });
        document.querySelectorAll('[id$="-chevron"]').forEach(ch => {
            ch.style.transform = 'rotate(0deg)';
        });
        
        // Open this dropdown if it was closed
        if (!isOpen) {
            dropdown.classList.remove('hidden');
            chevron.style.transform = 'rotate(180deg)';
        }
    }
    
    // Event listeners
    modelButton?.addEventListener('click', () => toggleDropdown(modelButton, modelDropdown, modelChevron));
    bookButton?.addEventListener('click', () => toggleDropdown(bookButton, bookDropdown, bookChevron));
    chapterButton?.addEventListener('click', () => toggleDropdown(chapterButton, chapterDropdown, chapterChevron));
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('[id$="-button"]') && !e.target.closest('[id$="-dropdown"]')) {
            document.querySelectorAll('[id$="-dropdown"]').forEach(dd => {
                dd.classList.add('hidden');
            });
            document.querySelectorAll('[id$="-chevron"]').forEach(ch => {
                ch.style.transform = 'rotate(0deg)';
            });
        }
    });
}

// Initialize on DOM load
document.addEventListener('DOMContentLoaded', () => {
    // Initialize custom dropdowns
    initializeCustomDropdowns();
});

// Helper functions for dropdown management
window.setModelDropdownOption = function(value, text, description = '', type = '') {
    const button = document.getElementById('translation-model-button');
    const textElement = document.getElementById('translation-model-text');
    const dropdown = document.getElementById('translation-model-dropdown');
    
    if (textElement) {
        textElement.textContent = text;
    }
    
    // Store the value on the button for retrieval
    button.dataset.value = value;
    
    // Remove model info update (description/type)
    const modelInfo = document.getElementById('model-info');
    if (modelInfo) modelInfo.classList.add('hidden');
    
    // Close dropdown
    dropdown.classList.add('hidden');
    document.getElementById('translation-model-chevron').style.transform = 'rotate(0deg)';
};

window.setBookDropdownOption = function(value, text) {
    const textElement = document.getElementById('goto-book-text');
    const button = document.getElementById('goto-book-button');
    const dropdown = document.getElementById('goto-book-dropdown');
    
    if (textElement) {
        textElement.textContent = text;
    }
    
    button.dataset.value = value;
    dropdown.classList.add('hidden');
    document.getElementById('goto-book-chevron').style.transform = 'rotate(0deg)';
};

window.setChapterDropdownOption = function(value, text) {
    const textElement = document.getElementById('goto-chapter-text');
    const button = document.getElementById('goto-chapter-button');
    const dropdown = document.getElementById('goto-chapter-dropdown');
    
    if (textElement) {
        textElement.textContent = text;
    }
    
    button.dataset.value = value;
    dropdown.classList.add('hidden');
    document.getElementById('goto-chapter-chevron').style.transform = 'rotate(0deg)';
};

window.populateModelDropdown = function(models) {
    const dropdown = document.getElementById('translation-model-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    models.forEach(model => {
        const option = document.createElement('div');
        option.className = 'dropdown-option px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-900 cursor-pointer border-b border-neutral-100 last:border-b-0 transition-all duration-200 flex items-center justify-between group';
        option.innerHTML = `
            <div class="flex-1">
                <div class="font-medium text-neutral-900">${model.name}</div>
                ${model.description ? `<div class="text-xs text-neutral-500 mt-1">${model.description}</div>` : ''}
            </div>
            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <i class="fas fa-check text-neutral-400 text-xs"></i>
            </div>
        `;
        option.addEventListener('click', () => {
            setModelDropdownOption(model.value, model.name, model.description, model.type);
            // Trigger change event for compatibility
            const event = new CustomEvent('change', { detail: { value: model.value } });
            document.getElementById('translation-model-button').dispatchEvent(event);
        });
        dropdown.appendChild(option);
    });
};

window.populateBookDropdown = function(books) {
    const dropdown = document.getElementById('goto-book-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    books.forEach(book => {
        const option = document.createElement('div');
        option.className = 'dropdown-option px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-900 cursor-pointer border-b border-neutral-100 last:border-b-0 transition-all duration-200 flex items-center justify-between group';
        option.innerHTML = `
            <div class="font-medium text-neutral-900">${book.name}</div>
            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <i class="fas fa-check text-neutral-400 text-xs"></i>
            </div>
        `;
        option.addEventListener('click', () => {
            setBookDropdownOption(book.value, book.name);
            // Trigger change event for compatibility
            const event = new CustomEvent('change', { detail: { value: book.value } });
            document.getElementById('goto-book-button').dispatchEvent(event);
        });
        dropdown.appendChild(option);
    });
};

window.populateChapterDropdown = function(chapters) {
    const dropdown = document.getElementById('goto-chapter-dropdown');
    if (!dropdown) return;
    
    dropdown.innerHTML = '';
    
    chapters.forEach(chapter => {
        const option = document.createElement('div');
        option.className = 'dropdown-option px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 hover:text-neutral-900 cursor-pointer border-b border-neutral-100 last:border-b-0 transition-all duration-200 flex items-center justify-between group';
        option.innerHTML = `
            <div class="font-medium text-neutral-900">${chapter.name}</div>
            <div class="opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <i class="fas fa-check text-neutral-400 text-xs"></i>
            </div>
        `;
        option.addEventListener('click', () => {
            setChapterDropdownOption(chapter.value, chapter.name);
            // Trigger change event for compatibility
            const event = new CustomEvent('change', { detail: { value: chapter.value } });
            document.getElementById('goto-chapter-button').dispatchEvent(event);
        });
        dropdown.appendChild(option);
    });
};
</script>
{% endmacro %} 